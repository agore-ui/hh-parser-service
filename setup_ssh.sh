#!/bin/bash

set -e

GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–ª—è GitHub...${NC}"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
if [ -f ~/.ssh/id_ed25519 ] || [ -f ~/.ssh/id_rsa ]; then
    echo -e "${GREEN}‚úÖ SSH –∫–ª—é—á–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç${NC}"
    
    if [ -f ~/.ssh/id_ed25519.pub ]; then
        echo -e "${BLUE}üìã –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á:${NC}"
        echo ""
        cat ~/.ssh/id_ed25519.pub
    elif [ -f ~/.ssh/id_rsa.pub ]; then
        echo -e "${BLUE}üìã –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á:${NC}"
        echo ""
        cat ~/.ssh/id_rsa.pub
    fi
else
    echo -e "${YELLOW}‚ö†Ô∏è  SSH –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π...${NC}"
    
    read -p "–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è SSH –∫–ª—é—á–∞: " SSH_EMAIL
    
    ssh-keygen -t ed25519 -C "$SSH_EMAIL" -f ~/.ssh/id_ed25519 -N ""
    
    echo -e "${GREEN}‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω!${NC}"
    echo ""
    echo -e "${BLUE}üìã –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á:${NC}"
    echo ""
    cat ~/.ssh/id_ed25519.pub
fi

echo ""
echo -e "${BLUE}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo -e "${YELLOW}üìå –î–ï–ô–°–¢–í–ò–Ø:${NC}"
echo ""
echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SSH –∫–ª—é—á –≤—ã—à–µ"
echo "2. –û—Ç–∫—Ä–æ–π—Ç–µ: https://github.com/settings/ssh/new"
echo "3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ –ø–æ–ª–µ 'Key'"
echo "4. –ù–∞–∂–º–∏—Ç–µ 'Add SSH key'"
echo ""
echo -e "${BLUE}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –∫–ª—é—á –Ω–∞ GitHub..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
echo ""
echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitHub...${NC}"

if timeout 5 ssh -T git@github.com 2>&1 | grep -q "successfully authenticated"; then
    echo -e "${GREEN}‚úÖ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitHub —Ä–∞–±–æ—Ç–∞–µ—Ç!${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitHub${NC}"
    echo "   –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∫–ª—é—á —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω"
fi

echo ""
echo -e "${GREEN}üéâ SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
